{% extends 'base.html' %}
{% load static %}
{% block detail-content %}
        <!-- Single Page Header start -->
        <div class="container-fluid page-header py-5">
            <h1 class="text-center text-white display-6" id="dish-title">Vietnamese Food Recipe</h1>
            <ol class="breadcrumb justify-content-center mb-0">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li class="breadcrumb-item"><a href="#">Vietnamese Food</a></li>
                <li class="breadcrumb-item active text-white" id="dish-breadcrumb">Recipe Detail</li>
            </ol>
        </div>
        <!-- Single Page Header End -->

        <!-- Vietnamese Food Detail Start -->
        <div class="container-fluid py-5 mt-5">
            <div class="container py-5">
                <div class="row g-4 mb-5">
                    <div class="col-lg-8 col-xl-9">
                        <div class="row g-4">
                            <div class="col-lg-6">
                                <div class="border rounded">
                                    <a href="#" data-lightbox="dish-gallery">
                                        <img id="main-image" src="{{ dish.image.url }}" class="img-fluid rounded" alt="Vietnamese Dish">
                                    </a>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <h4 class="fw-bold mb-3" id="dish-name">{{ dish.name }}</h4>
                                <p class="mb-3" id="dish-category">Category: {{ dish.category }}</p>
                                <h5 class="fw-bold mb-3">Description:</h5>
                                <p id="dish-description">{{ dish.description }}</p>
                            </div>
                            <div class="col-lg-12">
                                <nav>
                                    <div class="nav nav-tabs mb-3">
                                        <button class="nav-link active border-white border-bottom-0" type="button" role="tab" id="nav-about-tab" data-bs-toggle="tab" data-bs-target="#nav-about" aria-controls="nav-about" aria-selected="true">Ingredients</button>
                                        <button class="nav-link border-white border-bottom-0" type="button" role="tab" id="nav-mission-tab" data-bs-toggle="tab" data-bs-target="#nav-mission" aria-controls="nav-mission" aria-selected="false">Instructions</button>
                                        <button class="nav-link border-white border-bottom-0" type="button" role="tab" id="nav-vision-tab" data-bs-toggle="tab" data-bs-target="#nav-vision" aria-controls="nav-vision" aria-selected="false">Tips & Notes</button>
                                    </div>
                                </nav>
                                <div class="tab-content mb-5">
                                    <div class="tab-pane active" id="nav-about" role="tabpanel" aria-labelledby="nav-about-tab">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>For the Broth:</h5>
                                                <ul id="broth-ingredients">
                                                    {% for ingredient in ingredients %}
                                                        {% if ingredient.category == "Origin" %}
                                                            <li>{{ ingredient.name }}</li>
                                                        {% endif %}
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                            <div class="col-md-6">
                                                <h5>For Serving:</h5>
                                                <form id="serving-ingredients-form">
                                                    <ul id="serving-ingredients" class="list-unstyled">
                                                        {% for ingredient in ingredients %}
                                                            {% if ingredient.category == "Alter" %}
                                                                <li>
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="checkbox" id="serving-ingredient-{{ ingredient.id }}">
                                                                        <label class="form-check-label" for="serving-ingredient-{{ ingredient.id }}">{{ ingredient.name }}</label>
                                                                    </div>
                                                                </li>
                                                            {% endif %}
                                                        {% endfor %}
                                                    </ul>
                                                    <a href="{% url 'cart' %}" type="button" class="btn btn-primary rounded-pill mt-3" id="add-to-cart-btn">
                                                        <i class="fa fa-shopping-cart me-2"></i>Add Selected to Cart
                                                    </a>
                                                    <script>
                                                        document.getElementById('add-to-cart-btn').addEventListener('click', function(e) {
                                                            e.preventDefault();
                                                            // Lấy các nguyên liệu đã chọn (id)
                                                            const checked = Array.from(document.querySelectorAll('#serving-ingredients input[type="checkbox"]:checked'))
                                                                .map(cb => cb.id.replace('serving-ingredient-', ''));
                                                            if (checked.length === 0) {
                                                                alert('Please select at least one ingredient!');
                                                                return;
                                                            }
                                                            // Gửi AJAX lên server để thêm vào cart
                                                            fetch('/cart/add_ingredients/', {
                                                                method: 'POST',
                                                                headers: {
                                                                    'Content-Type': 'application/json',
                                                                    'X-CSRFToken': getCookie('csrftoken'),
                                                                },
                                                                body: JSON.stringify({ingredient_ids: checked})
                                                            })
                                                            .then(response => response.json())
                                                            .then(data => {
                                                                if (data.status === 'success') {
                                                                    window.location.href = '/cart/';
                                                                } else {
                                                                    alert('Error: ' + (data.message || 'Could not add to cart.'));
                                                                }
                                                            })
                                                            .catch(error => {
                                                                alert('Error: ' + error);
                                                            });
                                                        });
                                                        function getCookie(name) {
                                                            let cookieValue = null;
                                                            if (document.cookie && document.cookie !== '') {
                                                                const cookies = document.cookie.split(';');
                                                                for (let i = 0; i < cookies.length; i++) {
                                                                    const cookie = cookies[i].trim();
                                                                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                                                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                                                        break;
                                                                    }
                                                                }
                                                            }
                                                            return cookieValue;
                                                        }
                                                    </script>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="nav-mission" role="tabpanel" aria-labelledby="nav-mission-tab">
                                        <div class="row">
                                            <div class="col-12">
                                                <h5>Cooking Instructions:</h5>
                                                <div id="instructions">
                                                {{ dish.instructions | linebreaksbr }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="nav-vision" role="tabpanel" aria-labelledby="nav-vision-tab">
                                        <div class="row">
                                            <div class="col-12">
                                                <h5>Chef's Tips & Notes:</h5>
                                                <div id="tips">
                                                    {{ dish.notes | linebreaksbr }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        <!-- Vietnamese Food Detail End -->


{% endblock detail-content %}

